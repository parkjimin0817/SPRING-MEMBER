<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.brenex.pjm.mapper.MemberStatusHistoryMapper">
    <resultMap type="MemberStatusHistory" id="memberStatusHistoryResultMap">
        <!-- <result column="테이블의 컬럼명" property="객체의 필드명"/> -->
        <result column="HISTORY_NO" property="historyNo"/>
        <result column="MEMBER_NO" property="memberNo"/>
        <result column="OLD_STATUS" property="oldStatus"/>
        <result column="NEW_STATUS" property="newStatus"/>
        <result column="CHANGED_DATE" property="changedDate"/>
        <result column="CHANGED_REASON" property="changedReason"/>
        <result column="CHANGED_BY" property="changedBy"/>
    </resultMap>
    <!-- 상태 변경 기록 작성 -->
    <insert id="createStatusHistory">
        INSERT INTO
        MEMBER_STATUS_HISTORY (
            MEMBER_NO,
            OLD_STATUS,
            NEW_STATUS,
            CHANGED_REASON,
            CHANGED_BY
        )
        SELECT
            M.MEMBER_NO AS MEMBER_NO,
            M.MEMBER_STATUS AS OLD_STATUS,
            #{status} AS NEW_STATUS,
            #{reason} AS CHANGED_REASON,
            #{changedBy} AS CHANGED_BY
        FROM MEMBER M
        WHERE M.MEMBER_NO IN
            <foreach collection="memberNoList" item="memberNo" open="(" separator="," close=")">
                #{memberNo}
            </foreach>
    </insert>
</mapper>